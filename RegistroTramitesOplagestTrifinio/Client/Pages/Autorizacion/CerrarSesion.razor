@page "/salir"
@inject IGeneraRegistroActividad Registro
@inject ISesionService Sesion
@inject NavigationManager Navigation

@if (cerrandoSesion)
{
    <div class="d-flex align-items-center">
        <img src="images/progress.gif" width="50" />
        <p class="m-0">Cerrando sesi&oacute;n, por favor espere...</p>
    </div>
}

@code {
    [CascadingParameter] public Task<AuthenticationState> AuthenticationState { get; set; }

    private bool cerrandoSesion = false;

    protected override async Task OnInitializedAsync()
    {
        cerrandoSesion = true;

        var autenticacion = await AuthenticationState;

        await Registro.Generar(autenticacion.User.FindFirst(ClaimTypes.Email).Value, "Cierre de sesión en la aplicación.");
        await Sesion.Cerrar();

        Navigation.NavigateTo("ingresar");
    }
}
